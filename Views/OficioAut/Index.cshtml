@using PagedList.Mvc

@model PagedList.IPagedList<ConcursosContratos.Models.OficiosAutCLS>

<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
@{
    ViewBag.Title = "Index";
    List<SelectListItem> listaAut = (List<SelectListItem>)ViewBag.listaAut;
    List<SelectListItem> listaProg = (List<SelectListItem>)ViewBag.listaProg;
    

}

<h2>Index</h2>

<table>
    <thead>
        <tr>
            <td>No. Licitacion</td>
            <td>Tipo</td>
            <td>No. Obra</td>
            <td>No. Asignacion</td>
            <td>Descripcion</td>
            <td>Municipio</td>
            <td>Of. Aut.</td>
            <td>Fuente Fin.</td>
            <td>Origen</td>
            <td>Monto Aut</td>
            <td>No. Contrato</td>
            <td>Cancelado</td>
        </tr>
    </thead>
    <tbody></tbody>
</table>


<div class="form-group">
    @*@if (ViewBag.listaEdo != null)
    {
        @Html.DropDownList("EntidadId", listaEdo, new { @class = "form-control form-control-sm my-3 col-md-2", id = "Entidades" })
        @Html.ValidationMessage("Entidad", new { @class = "text-danger" })
    }

    @Html.DropDownList("IDREGION", new SelectList(""), "<--Seleccionar-->", new { @class = "form-control form-control-sm my-3 col-md-2 invisible", id = "Regiones" })*@

    @Html.Hidden("idmunicipio")
    @Html.TextBox("municipio", null, new { placeholder = "Municipio", @class = "form-control my-3 ", id = "municipio" })
</div>

@Html.DropDownList("IdPrograma", listaProg, new { @class = "form-control form-control-sm my-3 col-md-3" })
@Html.ValidationMessage("Progamado", new { @class = "text-danger" })

@Html.DropDownList("IdAutoriza", listaAut, new { @class = "form-control form-control-sm my-3 col-md-4" })
@Html.ValidationMessage("Autorizado", new { @class = "text-danger" })
<button type="button" class="btn btn-primary" onclick="Verid()">Primary</button>

<script src="https://code.jquery.com/jquery-1.12.4.min.js"
        integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
        crossorigin="anonymous"></script>

<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script>
    //var entidad = $("#Entidades");
    //var regiones = $("#Regiones");
    var mun = $("#municipio");
    //    mun.autocomplete({
    //    source: function (request, response) {
    //        $.get("/OficioAut/GetMunicipioList", { municipio: mun.val() }, function (data) {
    //            response($.map(data, function (item) {

    //                return { label: item.MUNICIPIO1, value: item.MUNICIPIO1, id: item.IDMUNICIPIO };

    //            })
    //            )
    //        })
    //        }
    //})

    mun.autocomplete({
        source: function (request, response) {
            $.ajax({
                url: "/OficioAut/GetMunicipioList",
                dataType: "json",
                type: "POST",
                data: { municipio: mun.val() },
                success: function (data) {
                    response($.map(data, function (item) {
                        return { label: item.MUNICIPIO1, value: item.MUNICIPIO1, id: item.IDMUNICIPIO };
                    }))
                },
                error: function (response) {
                    console.log(response.responseText);
                },
                failure: function (response) {
                    console.log(response.responseText)
                }
            });
        },
        select: function (e, i) {
         
                $("#idmunicipio").val(i.item.id);
          
        }
    });
    mun.change(function () {
       
        if ($("#idmunicipio").val() < 1) {
            Swal.fire({
                title: 'No existe',
                text: '¿Desea agregar el municipio: ' + mun.val() + ' ?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, ir a agregarlo!'})
        
        } else {
            console.log("existe")
        }
        $("#idmunicipio").val("");
     

    })
    //$(document).ready(function () {

    //    entidad.change(function () {
    //        regiones.empty();

    //        if (entidad.val() >= 1) {
    //            $.get("/OficioAut/GetRegionList", { EntidadId: entidad.val() }, function (data) {
    //                regiones.append("<option value=0><--Seleccionar--></option>")
    //                $.each(data, function (index, row) {
    //                    regiones.append("<option value='" + row.IDREGION + "'>" + row.REGION1 + "</option>")
    //                });
    //                regiones.removeClass("invisible");
    //            });
    //        } else {
    //            regiones.addClass("invisible");
    //            regiones.innerHTML = "<--Seleccionar-->";
    //        }
    //    });
    //});
    //regiones.change(function () {
    //    if (regiones.val() >= 1) {
    //        mun.removeClass("invisible");
    //    } else {
    //        mun.addClass("invisible");
    //        mun.innerHTML = "";
    //    }
    //});
    //mun.on("keyup", function () {
    //    if (mun.length != 0) {
    //        $.get("/OficioAut/GetMunicipioList", { RegionID: regiones.val(), municipio: mun.val() }, function (data) {
    //            $.each(data, function (index, row) {
    //                console.log(row.IDMUNICIPIO + "" + row.MUNICIPIO1)

    //            });
    //        });
    //    }
    //});
</script>
